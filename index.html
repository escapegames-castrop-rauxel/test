<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<title>Chatbot Test</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<link rel="icon" href="favicon.png" type="image/png">
<style>
:root{
  --bgDesktop: url("Gefängnisinsasse.png") no-repeat center center fixed;
  --bgMobile: url("Gefängnisinsasse_mobil.png") no-repeat center center fixed;
  --bot-bubble: #f1f0f0;
  --user-bubble: #4e9af1;
}

html,body{
  height:100%;
  margin:0;
  font-family: "Segoe UI", Tahoma, sans-serif;
  background: var(--bgDesktop);
  background-size: cover;
  background-position: center center;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:10px;
  box-sizing:border-box;
}

@media (max-width: 500px) {
  html,body { background: var(--bgMobile); }
}

#chat{
  width:90vw;
  max-width:520px;
  height:80vh;
  background: rgba(255,255,255,0.15);
  backdrop-filter: blur(6px);
  border-radius:18px;
  box-shadow: 0 16px 40px rgba(0,0,0,0.25);
  display:flex;
  flex-direction:column;
  overflow:hidden;
  position:relative;
  z-index:1;
}

#messages{flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;gap:12px;}
.message{display:flex;align-items:flex-end;max-width:75%;}
.message.user{align-self:flex-end;flex-direction:row-reverse;}
.message.bot{align-self:flex-start;}
.message img{width:36px; height:36px; border-radius:50%; margin:0 8px; flex-shrink:0; object-fit:cover;}
.bubble{padding:10px 14px; border-radius:16px; font-size:14px; line-height:1.4; box-shadow:0 2px 6px rgba(0,0,0,0.08); word-wrap:break-word;}
.bot .bubble{background:var(--bot-bubble);color:#111;border-bottom-left-radius:6px;}
.user .bubble{background:var(--user-bubble);color:#fff;border-bottom-right-radius:6px;}
#inputArea{display:flex;padding:10px;background:rgba(250,250,250,0.7);border-top:1px solid #eee;}
#userInput{flex:1;padding:10px;border-radius:24px;border:1px solid #ccc;font-size:14px;outline:none;}
button#send{margin-left:8px;padding:10px 16px;border-radius:20px;border:none;background:#4e9af1;color:#fff;cursor:pointer;font-weight:600;}
button#send:active{transform:translateY(1px);}
</style>
</head>
<body>

<div id="chat" role="application" aria-label="Chatbot">
  <div id="messages" aria-live="polite"></div>
  <div id="inputArea">
    <input id="userInput" type="text" placeholder="Schreib etwas..." aria-label="Nachricht eingeben" />
    <button id="send">Senden</button>
  </div>
</div>

<script>
let story;

const messages = document.getElementById('messages');
const input = document.getElementById('userInput');
const sendBtn = document.getElementById('send');

const botAvatar = "bot.png";
const userAvatar = "user.png";

// Nachricht einfügen
function addMessage(text,sender='bot'){
  const msgWrap=document.createElement('div');
  msgWrap.className='message '+sender;
  const img=document.createElement('img');
  img.src=(sender==='bot')?botAvatar:userAvatar;
  img.alt = sender==='bot' ? 'Bot' : 'Du';
  const bubble=document.createElement('div');
  bubble.className='bubble';
  bubble.textContent=text;
  if(sender==='bot'){msgWrap.appendChild(img);msgWrap.appendChild(bubble);}
  else{msgWrap.appendChild(bubble);msgWrap.appendChild(img);}
  messages.appendChild(msgWrap);
  messages.scrollTop = messages.scrollHeight;
}

// Bot tippt
function botType(text, delay=1500){
  return new Promise(resolve=>{
    const typing=document.createElement('div');
    typing.className='message bot';
    typing.innerHTML=`<img src="${botAvatar}" alt="Bot"><div class="bubble"><em>… tippt</em></div>`;
    messages.appendChild(typing);
    messages.scrollTop=messages.scrollHeight;
    setTimeout(()=>{
      typing.remove();
      addMessage(text,'bot');
      resolve();
    }, delay);
  });
}

// Chat starten
function initChat(){
  botType(story.startMessage);
}

// Eingabe
function sendMessage(){
  const txt = input.value.trim();
  if(!txt) return;
  addMessage(txt,'user');
  input.value='';

  const userInputLower = txt.toLowerCase();

  // Hilfe-Trigger prüfen
  if(story.helpTriggers.some(trigger => userInputLower.includes(trigger))){
    const hint = story.helpResponses[Math.floor(Math.random()*story.helpResponses.length)];
    botType(hint);
    return;
  }

  // Standardantwort, falls keine Trigger
  botType(story.defaultResponse);
}

// Events
sendBtn.addEventListener('click',sendMessage);
input.addEventListener('keydown',e=>{if(e.key==='Enter') sendMessage();});

// Story laden und Chat starten
fetch("story.json")
  .then(res => res.json())
  .then(data => {
    story = data;
    initChat();
  })
  .catch(err => console.error("Story konnte nicht geladen werden:", err));

</script>
</body>
</html>
